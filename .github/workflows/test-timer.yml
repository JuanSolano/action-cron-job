name: Test NY Timer

on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *'   # every 5 minutes

jobs:
  test-time:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Run timer check (dry)
        run: |
          echo "UTC time:"
          date -u
          echo "New York time:"
          TZ=America/New_York date
          node HPTO/scripts/should-purge.mjs

      - name: Send notification
        if: always()
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "Notification sent manually by user."
          else
            echo "Notification sent automatically by schedule."
          fi
